<div class="layout-container flex h-full grow flex-col">
    <div class="px-4 md:px-10 lg:px-40 flex flex-1 justify-center py-5">
        <div class="layout-content-container flex flex-col max-w-[1200px] flex-1">
            <!-- Page Heading -->
            <!-- Confirmation Message -->
            <div *ngIf="confirmationMessage" class="p-4">
                <div class="p-4 rounded-lg bg-green-500/10 border border-green-500/30 text-green-500 text-sm">
                    {{ confirmationMessage }}
                </div>
            </div>
            <div class="flex flex-wrap justify-between gap-3 p-4">
                <div class="flex flex-col gap-3">
                    <h1 class="text-white text-4xl font-black leading-tight tracking-[-0.033em]">Solicitar Turno</h1>
                    <p class="text-text-secondary text-base font-normal leading-normal">Reservá un espacio para el
                        mantenimiento de tu moto en pocos pasos.</p>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 p-4">
                <!-- Left Column: Steps -->
                <div class="lg:col-span-8 flex flex-col gap-8">
                    <!-- Step 1: Vehicle -->
                    <section class="flex flex-col gap-4">
                        <h3 class="text-white tracking-light text-2xl font-bold leading-tight flex items-center gap-3">
                            <span
                                class="bg-surface-dark border border-border-dark text-white text-sm rounded-full w-8 h-8 flex items-center justify-center font-bold">1</span>
                            Seleccioná tu vehículo
                        </h3>
                        <div class="bg-surface-dark rounded-xl p-6 border border-border-dark">
                            <label class="flex flex-col w-full">
                                <span class="text-text-secondary text-sm font-medium leading-normal pb-2">Moto
                                    registrada</span>
                                <div class="relative">
                                    <select [value]="selectedMotorcycleId" (change)="selectMotorcycle($event)"
                                        class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-white focus:outline-0 focus:ring-2 focus:ring-primary/50 border border-border-dark bg-[#111318] h-14 pl-4 pr-10 text-base font-normal leading-normal appearance-none cursor-pointer">
                                        <option *ngFor="let moto of motorcycles" [value]="moto.id">{{ moto.displayName
                                            }}</option>
                                        <option value="add">+ Agregar nueva moto</option>
                                    </select>
                                    <div
                                        class="absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-text-secondary">
                                        <span class="material-symbols-outlined">expand_more</span>
                                    </div>
                                </div>
                            </label>
                        </div>
                    </section>
                    <!-- Step 2: Service -->
                    <section class="flex flex-col gap-4">
                        <h3 class="text-white tracking-light text-2xl font-bold leading-tight flex items-center gap-3">
                            <span
                                class="bg-surface-dark border border-border-dark text-white text-sm rounded-full w-8 h-8 flex items-center justify-center font-bold">2</span>
                            Tipo de Servicio
                        </h3>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div *ngFor="let service of services" (click)="selectService(service)"
                                [class]="isServiceSelected(service) ? 'bg-primary/10 border-2 border-primary' : 'bg-surface-dark border border-border-dark'"
                                class="rounded-xl p-4 flex flex-col gap-3 cursor-pointer relative overflow-hidden group hover:border-primary/50 transition-all">
                                <div *ngIf="isServiceSelected(service)" class="absolute top-3 right-3 text-primary">
                                    <span class="material-symbols-outlined filled">check_circle</span>
                                </div>
                                <div [class]="isServiceSelected(service) ? 'bg-primary/20 text-primary' : 'bg-[#292e38] text-white'"
                                    class="size-10 rounded-lg flex items-center justify-center">
                                    <span class="material-symbols-outlined">{{ service.icon }}</span>
                                </div>
                                <div>
                                    <h4 class="text-white font-bold text-lg">{{ service.name }}</h4>
                                    <p class="text-text-secondary text-sm mt-1">{{ service.description }}</p>
                                </div>
                                <div class="mt-auto pt-2 flex items-center justify-between text-sm">
                                    <span class="text-white font-semibold">{{ getFormattedPrice(service.price) }}</span>
                                    <span class="text-text-secondary">{{ service.duration }}</span>
                                </div>
                            </div>
                        </div>
                    </section>
                    <!-- Step 3: Date & Time -->
                    <section class="flex flex-col gap-4">
                        <h3 class="text-white tracking-light text-2xl font-bold leading-tight flex items-center gap-3">
                            <span
                                class="bg-surface-dark border border-border-dark text-white text-sm rounded-full w-8 h-8 flex items-center justify-center font-bold">3</span>
                            Fecha y Hora
                        </h3>
                        <div
                            class="bg-surface-dark rounded-xl border border-border-dark overflow-hidden flex flex-col md:flex-row">
                            <!-- Calendar -->
                            <div class="p-6 flex-1 border-b md:border-b-0 md:border-r border-border-dark">
                                <div class="flex items-center justify-between mb-6">
                                    <button (click)="previousMonth()"
                                        class="p-1 rounded-full hover:bg-border-dark text-text-secondary hover:text-white transition-colors">
                                        <span class="material-symbols-outlined">chevron_left</span>
                                    </button>
                                    <span class="text-lg font-bold text-white">{{ monthName }}</span>
                                    <button (click)="nextMonth()"
                                        class="p-1 rounded-full hover:bg-border-dark text-text-secondary hover:text-white transition-colors">
                                        <span class="material-symbols-outlined">chevron_right</span>
                                    </button>
                                </div>
                                <div class="grid grid-cols-7 gap-2 text-center text-sm mb-2">
                                    <div class="text-text-secondary font-medium">Do</div>
                                    <div class="text-text-secondary font-medium">Lu</div>
                                    <div class="text-text-secondary font-medium">Ma</div>
                                    <div class="text-text-secondary font-medium">Mi</div>
                                    <div class="text-text-secondary font-medium">Ju</div>
                                    <div class="text-text-secondary font-medium">Vi</div>
                                    <div class="text-text-secondary font-medium">Sa</div>
                                </div>
                                <div class="grid grid-cols-7 gap-2 text-center">
                                    <div class="h-10 w-10 flex items-center justify-center text-text-secondary/30">29
                                    </div>
                                    <div class="h-10 w-10 flex items-center justify-center text-text-secondary/30">30
                                    </div>
                                    <div class="h-10 w-10 flex items-center justify-center text-text-secondary/30">1
                                    </div>
                                    <div *ngFor="let day of calendarDays"
                                        (click)="!isDayDisabled(day) && selectDate(day)"
                                        [class]="isDateSelected(day) ? 'bg-primary text-white font-bold shadow-lg shadow-primary/20' : isDayDisabled(day) ? 'text-text-secondary/50 cursor-not-allowed' : 'hover:bg-border-dark cursor-pointer text-white'"
                                        class="h-10 w-10 flex items-center justify-center rounded-full transition-colors">
                                        {{ day }}
                                    </div>
                                </div>
                            </div>
                            <!-- Time Slots -->
                            <div class="p-6 flex-1 bg-[#161920]">
                                <div class="mb-4">
                                    <h4 class="text-white font-medium mb-1">Horarios Disponibles</h4>
                                    <p class="text-text-secondary text-sm">Para el Sábado 14 de Octubre</p>
                                </div>
                                <div class="grid grid-cols-2 gap-3">
                                    <button *ngFor="let slot of timeSlots" (click)="selectTimeSlot(slot)"
                                        [disabled]="!slot.available"
                                        [class]="isTimeSelected(slot.time) ? 'bg-primary text-white border-primary shadow-lg shadow-primary/20' : slot.available ? 'border-border-dark text-text-secondary hover:border-white hover:text-white' : 'border-border-dark text-text-secondary/50 line-through cursor-not-allowed bg-background-dark/50'"
                                        class="py-2 px-4 rounded-lg border transition-all text-sm font-medium">
                                        {{ slot.time }}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
                <!-- Right Column: Summary -->
                <div class="lg:col-span-4">
                    <div class="sticky top-24 flex flex-col gap-6">
                        <div class="bg-surface-dark border border-border-dark rounded-xl p-6 shadow-xl">
                            <h3 class="text-xl font-bold text-white mb-6 pb-4 border-b border-border-dark">Resumen del
                                Turno</h3>
                            <div class="flex flex-col gap-4 mb-6">
                                <div class="flex gap-3 items-start">
                                    <div class="text-primary mt-0.5">
                                        <span class="material-symbols-outlined text-lg">two_wheeler</span>
                                    </div>
                                    <div>
                                        <p class="text-text-secondary text-xs uppercase tracking-wider font-bold">
                                            Vehículo</p>
                                        <p class="text-white font-medium">{{ selectedMotorcycle?.brand }} {{
                                            selectedMotorcycle?.model }}</p>
                                    </div>
                                </div>
                                <div class="flex gap-3 items-start">
                                    <div class="text-primary mt-0.5">
                                        <span class="material-symbols-outlined text-lg">build_circle</span>
                                    </div>
                                    <div>
                                        <p class="text-text-secondary text-xs uppercase tracking-wider font-bold">
                                            Servicio</p>
                                        <p class="text-white font-medium">{{ selectedService?.name || 'No seleccionado'
                                            }}</p>
                                    </div>
                                </div>
                                <div class="flex gap-3 items-start">
                                    <div class="text-primary mt-0.5">
                                        <span class="material-symbols-outlined text-lg">calendar_month</span>
                                    </div>
                                    <div>
                                        <p class="text-text-secondary text-xs uppercase tracking-wider font-bold">Fecha
                                            y Hora</p>
                                        <p class="text-white font-medium">{{ selectedDate ? 'Sáb ' + selectedDate + '
                                            Oct, ' + selectedTime : 'No seleccionado' }}</p>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-[#111318] rounded-lg p-4 mb-6 border border-border-dark">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-text-secondary text-sm">Subtotal</span>
                                    <span class="text-white text-sm">{{ getFormattedPrice(getTotalPrice()) }}</span>
                                </div>
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-text-secondary text-sm">Reserva</span>
                                    <span class="text-green-500 text-sm">Gratis</span>
                                </div>
                                <div class="h-px bg-border-dark my-2"></div>
                                <div class="flex justify-between items-center">
                                    <span class="text-white font-bold">Total Estimado</span>
                                    <span class="text-xl font-bold text-white">{{ getFormattedPrice(getTotalPrice())
                                        }}</span>
                                </div>
                            </div>
                            <button (click)="confirmAppointment()"
                                class="w-full bg-primary hover:bg-blue-600 text-white font-bold py-4 rounded-lg transition-all shadow-lg shadow-primary/20 flex items-center justify-center gap-2">
                                <span>Confirmar Turno</span>
                                <span class="material-symbols-outlined text-sm">arrow_forward</span>
                            </button>
                            <p class="text-center text-text-secondary text-xs mt-4">
                                Al confirmar, aceptás nuestras políticas de cancelación.
                            </p>
                        </div>
                        <!-- Help Card -->
                        <div
                            class="bg-surface-dark/50 border border-border-dark rounded-xl p-4 flex gap-4 items-center">
                            <div class="rounded-full bg-background-dark p-2 text-text-secondary">
                                <span class="material-symbols-outlined">support_agent</span>
                            </div>
                            <div>
                                <p class="text-white text-sm font-medium">¿Necesitas ayuda?</p>
                                <a routerLink="/contacto" class="text-primary text-sm hover:underline">Contactar
                                    soporte</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>